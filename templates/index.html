<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Churn Prediction AI | Customer Analytics</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-chart-line"></i>
                <span>ChurnAI</span>
            </div>
            <nav class="nav">
                <a href="#" class="nav-link active">Dashboard</a>
                <a href="#" class="nav-link">Analytics</a>
                <a href="#" class="nav-link">Reports</a>
            </nav>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Hero Section -->
        <section class="hero-section">
            <div class="hero-content">
                <h1 class="hero-title">AI-Powered Customer Churn Prediction</h1>
                <p class="hero-subtitle">Intelligent forecasting with dynamic thresholds and SHAP explainability</p>
                <div class="hero-features">
                    <div class="feature-badge">
                        <i class="fas fa-brain"></i>
                        <span>Machine Learning</span>
                    </div>
                    <div class="feature-badge">
                        <i class="fas fa-bolt"></i>
                        <span>Dynamic Thresholds</span>
                    </div>
                    <div class="feature-badge">
                        <i class="fas fa-dollar-sign"></i>
                        <span>Revenue Impact</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Info Card -->
        <div class="info-card">
            <div class="info-icon">
                <i class="fas fa-lightbulb"></i>
            </div>
            <div class="info-content">
                <h3>Smart Personalization</h3>
                <p>Our system uses customer-specific thresholds based on lifetime value. High-value customers receive more aggressive retention strategies, ensuring optimal business outcomes.</p>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="content-grid">
            <!-- Left Column - Form -->
            <div class="form-container">
                <div class="section-header">
                    <h2 class="section-title">Customer Information</h2>
                    <p class="section-subtitle">Enter customer details for AI analysis</p>
                </div>

                <form action="/predict" method="POST" id="predictionForm" class="prediction-form">
                    <!-- Personal Information -->
                    <div class="form-section">
                        <h3 class="form-section-title">
                            <i class="fas fa-user"></i>
                            Personal Details
                        </h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="gender">Gender</label>
                                <select name="gender" id="gender" required>
                                    <option value="">Select Gender</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="age">Age</label>
                                <input type="number" name="age" id="age" min="18" max="100" placeholder="e.g., 35" required>
                            </div>

                            <div class="form-group">
                                <label for="married">Marital Status</label>
                                <select name="married" id="married" required>
                                    <option value="">Select Status</option>
                                    <option value="Yes">Married</option>
                                    <option value="No">Single</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="number_of_dependents">Dependents</label>
                                <input type="number" name="number_of_dependents" id="number_of_dependents" min="0" placeholder="0" required>
                            </div>
                        </div>
                    </div>

                    <!-- Account Information -->
                    <div class="form-section">
                        <h3 class="form-section-title">
                            <i class="fas fa-clock"></i>
                            Account Details
                        </h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="tenure_in_months">Tenure (Months)</label>
                                <input type="number" name="tenure_in_months" id="tenure_in_months" min="0" placeholder="e.g., 24" required>
                            </div>

                            <div class="form-group">
                                <label for="number_of_referrals">Referrals</label>
                                <input type="number" name="number_of_referrals" id="number_of_referrals" min="0" placeholder="0" required>
                            </div>

                            <div class="form-group">
                                <label for="offer">Current Offer</label>
                                <select name="offer" id="offer" required>
                                    <option value="">Select Offer</option>
                                    <option value="None">No Offer</option>
                                    <option value="Offer A">Offer A</option>
                                    <option value="Offer B">Offer B</option>
                                    <option value="Offer C">Offer C</option>
                                    <option value="Offer D">Offer D</option>
                                    <option value="Offer E">Offer E</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="contract">Contract Type</label>
                                <select name="contract" id="contract" required>
                                    <option value="">Select Contract</option>
                                    <option value="Month-to-Month">Month-to-Month</option>
                                    <option value="One Year">One Year</option>
                                    <option value="Two Year">Two Year</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Services -->
                    <div class="form-section">
                        <h3 class="form-section-title">
                            <i class="fas fa-wifi"></i>
                            Services & Features
                        </h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="phone_service">Phone Service</label>
                                <select name="phone_service" id="phone_service" required>
                                    <option value="">Select</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="multiple_lines">Multiple Lines</label>
                                <select name="multiple_lines" id="multiple_lines" required>
                                    <option value="">Select</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="internet_service">Internet Service</label>
                                <select name="internet_service" id="internet_service" required>
                                    <option value="">Select</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="internet_type">Internet Type</label>
                                <select name="internet_type" id="internet_type" required>
                                    <option value="">Select Type</option>
                                    <option value="None">None</option>
                                    <option value="DSL">DSL</option>
                                    <option value="Cable">Cable</option>
                                    <option value="Fiber Optic">Fiber Optic</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="online_security">Online Security</label>
                                <select name="online_security" id="online_security" required>
                                    <option value="">Select</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="online_backup">Online Backup</label>
                                <select name="online_backup" id="online_backup" required>
                                    <option value="">Select</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="device_protection_plan">Device Protection</label>
                                <select name="device_protection_plan" id="device_protection_plan" required>
                                    <option value="">Select</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="premium_tech_support">Tech Support</label>
                                <select name="premium_tech_support" id="premium_tech_support" required>
                                    <option value="">Select</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="streaming_tv">Streaming TV</label>
                                <select name="streaming_tv" id="streaming_tv" required>
                                    <option value="">Select</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="streaming_movies">Streaming Movies</label>
                                <select name="streaming_movies" id="streaming_movies" required>
                                    <option value="">Select</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="streaming_music">Streaming Music</label>
                                <select name="streaming_music" id="streaming_music" required>
                                    <option value="">Select</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="unlimited_data">Unlimited Data</label>
                                <select name="unlimited_data" id="unlimited_data" required>
                                    <option value="">Select</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Financial Information -->
                    <div class="form-section">
                        <h3 class="form-section-title">
                            <i class="fas fa-dollar-sign"></i>
                            Financial Details
                        </h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="monthly_charge">Monthly Charge ($)</label>
                                <input type="number" name="monthly_charge" id="monthly_charge" step="0.01" min="0" placeholder="85.50" required>
                            </div>

                            <div class="form-group">
                                <label for="total_revenue">Total Revenue ($)</label>
                                <input type="number" name="total_revenue" id="total_revenue" step="0.01" min="0" placeholder="2050.00" required>
                            </div>

                            <div class="form-group">
                                <label for="total_refunds">Total Refunds ($)</label>
                                <input type="number" name="total_refunds" id="total_refunds" step="0.01" min="0" placeholder="0.00" required>
                            </div>

                            <div class="form-group">
                                <label for="total_extra_data_charges">Extra Data Charges ($)</label>
                                <input type="number" name="total_extra_data_charges" id="total_extra_data_charges" step="0.01" min="0" placeholder="0.00" required>
                            </div>

                            <div class="form-group">
                                <label for="avg_monthly_long_distance_charges">Avg Long Distance ($)</label>
                                <input type="number" name="avg_monthly_long_distance_charges" id="avg_monthly_long_distance_charges" step="0.01" min="0" placeholder="15.50" required>
                            </div>

                            <div class="form-group">
                                <label for="total_long_distance_charges">Total Long Distance ($)</label>
                                <input type="number" name="total_long_distance_charges" id="total_long_distance_charges" step="0.01" min="0" placeholder="372.00" required>
                            </div>

                            <div class="form-group">
                                <label for="avg_monthly_gb_download">Avg Monthly GB</label>
                                <input type="number" name="avg_monthly_gb_download" id="avg_monthly_gb_download" step="0.01" min="0" placeholder="25.5" required>
                            </div>

                            <div class="form-group">
                                <label for="paperless_billing">Paperless Billing</label>
                                <select name="paperless_billing" id="paperless_billing" required>
                                    <option value="">Select</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="payment_method">Payment Method</label>
                                <select name="payment_method" id="payment_method" required>
                                    <option value="">Select Method</option>
                                    <option value="Credit Card">Credit Card</option>
                                    <option value="Bank Withdrawal">Bank Withdrawal</option>
                                    <option value="Mailed Check">Mailed Check</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="submit-button">
                        <i class="fas fa-brain"></i>
                        <span>Analyze Customer Risk</span>
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </form>
            </div>

            <!-- Right Column - Results -->
            <div class="results-container">
                {% if prediction %}
                <!-- Prediction Result -->
                <div class="result-card prediction-card {% if prediction == 'Churned' %}churned{% else %}stayed{% endif %}">
                    <div class="result-icon">
                        {% if prediction == 'Churned' %}
                        <i class="fas fa-exclamation-triangle"></i>
                        {% else %}
                        <i class="fas fa-check-circle"></i>
                        {% endif %}
                    </div>
                    <h2 class="result-title">Prediction: {{ prediction }}</h2>
                    {% if churn_probability %}
                    <div class="result-stats">
                        <div class="stat-item">
                            <span class="stat-label">Churn Probability</span>
                            <span class="stat-value">{{ churn_probability }}%</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Risk Level</span>
                            <span class="stat-value risk-badge">{{ risk_level }}</span>
                        </div>
                    </div>
                    <div class="threshold-info">
                        <i class="fas fa-bolt"></i>
                        Dynamic Threshold: <strong>{{ threshold_used }}</strong>
                    </div>
                    {% endif %}
                </div>

                <!-- Revenue Impact -->
                {% if clv %}
                <div class="result-card revenue-card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-pie"></i> Revenue Impact Analysis</h3>
                        <span class="badge">Customer-Specific</span>
                    </div>
                    
                    <div class="metrics-grid">
                        <div class="metric-box">
                            <div class="metric-icon clv">
                                <i class="fas fa-gem"></i>
                            </div>
                            <div class="metric-content">
                                <span class="metric-label">Customer Lifetime Value</span>
                                <span class="metric-value">${{ "%.2f"|format(clv) }}</span>
                            </div>
                        </div>

                        <div class="metric-box">
                            <div class="metric-icon risk">
                                <i class="fas fa-exclamation-circle"></i>
                            </div>
                            <div class="metric-content">
                                <span class="metric-label">Revenue at Risk</span>
                                <span class="metric-value">${{ "%.2f"|format(revenue_at_risk) }}</span>
                            </div>
                        </div>

                        <div class="metric-box">
                            <div class="metric-icon tier">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="metric-content">
                                <span class="metric-label">Revenue Tier</span>
                                <span class="metric-value">{{ revenue_tier }}</span>
                            </div>
                        </div>

                        <div class="metric-box">
                            <div class="metric-icon priority">
                                <i class="fas fa-flag"></i>
                            </div>
                            <div class="metric-content">
                                <span class="metric-label">Priority Level</span>
                                <span class="metric-value">{{ priority }}</span>
                            </div>
                        </div>
                    </div>

                    {% if recommended_offer %}
                    <div class="recommended-offer">
                        <i class="fas fa-gift"></i>
                        <div>
                            <strong>Recommended Offer</strong>
                            <p>{{ recommended_offer|upper }}</p>
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                <!-- Churn Category -->
                {% if category %}
                <div class="result-card category-card">
                    <div class="card-header">
                        <h3><i class="fas fa-tags"></i> Churn Category</h3>
                    </div>
                    <div class="category-badge">{{ category }}</div>
                </div>
                {% endif %}

                <!-- SHAP Features -->
                {% if top_features %}
                <div class="result-card shap-card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-bar"></i> Top Risk Factors</h3>
                        <span class="badge">SHAP Analysis</span>
                    </div>
                    
                    <div class="features-list">
                        {% for feature in top_features %}
                        <div class="feature-item">
                            <span class="feature-name">{{ feature.name }}</span>
                            <div class="feature-bar-container">
                                <div class="feature-bar" data-width="{{ feature.value }}"></div>
                            </div>
                            <span class="feature-value">{{ feature.value }}%</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Insights -->
                {% if insights %}
                <div class="result-card insights-card">
                    <div class="card-header">
                        <h3><i class="fas fa-lightbulb"></i> Key Insights</h3>
                    </div>
                    <ul class="insights-list">
                        {% for insight in insights %}
                        <li><i class="fas fa-check"></i> {{ insight }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                <!-- Recommendations -->
                {% if recommendations %}
                <div class="result-card recommendations-card">
                    <div class="card-header">
                        <h3><i class="fas fa-tasks"></i> Action Plan</h3>
                    </div>
                    <ul class="recommendations-list">
                        {% for rec in recommendations %}
                        <li><i class="fas fa-arrow-right"></i> {{ rec }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% endif %}
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2024 ChurnAI. Powered by Machine Learning & SHAP Explainability.</p>
    </footer>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>